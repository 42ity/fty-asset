# WARNING: This unit is intended for systems or containers dedicated as
# 42ity execution environments. It disables any existing MySQL server.

[Unit]
Description=MySQL server for 42ity usage
Conflicts=mysql.service mysqld.service mariadb.service
# Not Requires, not Requisite... Wants and ExecStartPre hack, see https://github.com/systemd/systemd/issues/1312
#Wants=basic.target network.target fty-license-accepted.service
Requisite=basic.target network.target fty-license-accepted.service
After=basic.target network.target fty-license-accepted.service
PartOf=bios.target

[Service]
Type=forking
#ExecStartPre=-/bin/systemctl stop mysql.service
#ExecStartPre=-/bin/systemctl disable mysql.service
#ExecStartPre=-/bin/systemctl mask mysql.service
#ExecStartPre=-/bin/systemctl stop mysqld.service
#ExecStartPre=-/bin/systemctl disable mysqld.service
#ExecStartPre=-/bin/systemctl mask mysqld.service
#ExecStartPre=-/bin/systemctl stop mariadb.service
#ExecStartPre=-/bin/systemctl disable mariadb.service
#ExecStartPre=-/bin/systemctl mask mariadb.service
#ExecStartPre=/bin/dash -c "while ! /bin/systemctl is-active fty-license-accepted.service ; do sleep 3 ; done"
#ExecStartPre=/bin/systemctl is-active fty-license-accepted.service
#RestartSec=3
ExecStartPre=/bin/dash -c "if [ -d /var/lib/mysql ] ; then /bin/chown -R mysql:mysql /var/lib/mysql ; fi"
ExecStart=/usr/lib/mysql/rcmysql start
ExecStop=/usr/lib/mysql/rcmysql stop
TimeoutStartSec=0
Restart=on-failure

[Install]
WantedBy=bios.target
